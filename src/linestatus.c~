#include <pebble.h>
#include "linestatus.h"

static LineStatus *first;

LineStatus *addLineStatus(const char *line_name, int status) {
  LineStatus *new, *last;

  new = (LineStatus*)malloc(sizeof(LineStatus));
  if (new == NULL) {
    APP_LOG(APP_LOG_LEVEL_ERROR, "malloc of LineStatus failed");
  } else {
    new->line_name = (char*)malloc(strlen(line_name));
    if (new->line_name == NULL) {
      APP_LOG(APP_LOG_LEVEL_ERROR, "malloc of LineStatus->linename failed");
    } else {
      strncpy(new->line_name, line_name, strlen(line_name));
      new->status = status;
    }
  }

  if (first == NULL) {
    APP_LOG(APP_LOG_LEVEL_DEBUG, "addLinestatus first");
    first = new;
  } else {
    APP_LOG(APP_LOG_LEVEL_DEBUG, "addLinestatus not first");
    last = first;
    while (last->next != NULL)
      last = last->next;

    last->next = new;
  }
  return new;
}

void deleteLineStatus(void) {
  LineStatus *cur, *next;

  APP_LOG(APP_LOG_LEVEL_DEBUG, "deleteLinestatus in");

  cur = first;
  while (cur != NULL) {
    APP_LOG(APP_LOG_LEVEL_DEBUG, "deletelinestatus freeing line %s", cur->line_name);
    free(cur->line_name);
    next = cur->next;
    free(cur);
    cur = next;
  }
}
